<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Hello WebAssembly</title>
    <script>
        var importObject = {
            imports: {
                imported_func: function(arg) {
                console.log(arg);
                }
            }
        }

        if ('WebAssembly' in window) {
            fetch('main.wasm')
                .then(response => response.arrayBuffer())
                .then(buffer => WebAssembly.instantiate(buffer, importObject))
                .then(result => {
                    console.log(result);
                })
            // .then(buffer => WebAssembly.compile(buffer))
            // .then(module => {
            //     const instance = new WebAssembly.Instance(module);
            //     console.log(instance.exports.__heap_base);
            //     console.log(instance.exports.get_heap_base());
            //     document.getElementById("btn").addEventListener("click", function() {
            //     var lvalue = document.getElementById("lvalue").value;
            //     var rvalue = document.getElementById("rvalue").value;
            //     document.getElementById("result").setAttribute('value', instance.exports.add(lvalue, rvalue));
            //     }, false);
            //     });
        } else {
            output.value = "Your browser doesn't support Web Assembly. You may need to enable it in your browser's flags.";
        }
    // let memory = new WebAssembly.Memory({initial:10, maximum:100});
    // WebAssembly.instantiate(fetch('main.wasm'), { js: { mem: memory } })
    //     .then(obj => {
    //         // var i32 = new Uint32Array(memory.buffer);
    //         // for (var i = 0; i < 10; i++) {
    //         // i32[i] = i;
    //         // }
    //         // var sum = obj.instance.exports.accumulate(0, 10);
    //         // console.log(sum);
    //     });
    </script>
    </head>
<body>
    <input type="text" id="lvalue" value="1"/> +
    <input type="text" id="rvalue" value="2"/> =
    <input type="text" id="result" disabled/>
    <input type="button" id="btn" value="Run" />
</body>
</html>